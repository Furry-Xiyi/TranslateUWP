<Page
    x:Class="TranslatorApp.MainPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:controls="using:Microsoft.UI.Xaml.Controls"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:local="using:TranslatorApp"
    mc:Ignorable="d">

    <Page.Resources>
        <local:InverseBoolToVisibilityConverter x:Key="InverseBoolToVisibilityConverter"/>
    </Page.Resources>

    <Grid x:Name="RootGrid" UseLayoutRounding="True">
        <Grid.Resources>
            <x:Double x:Key="ContentDialogMaxWidth">800</x:Double>

            <DataTemplate x:Key="WelcomeApiExpanderTemplate">
                <StackPanel Width="600" HorizontalAlignment="Stretch">
                    <controls:Expander IsExpanded="False" 
                               HorizontalAlignment="Stretch" 
                               HorizontalContentAlignment="Left" 
                               MinHeight="80">
                        <controls:Expander.Header>
                            <Grid HorizontalAlignment="Stretch">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <FontIcon Glyph="&#xE946;" FontSize="20" Margin="0,0,12,0"/>
                                <StackPanel Grid.Column="1">
                                    <TextBlock Text="如何获取 API 密钥" FontSize="16" FontWeight="Bold"/>
                                    <TextBlock Text="点击链接前往相关网站注册" FontSize="12" Foreground="Gray"/>
                                </StackPanel>
                            </Grid>
                        </controls:Expander.Header>
                        <StackPanel Orientation="Horizontal" Spacing="12" Margin="0,8,0,0">
                            <HyperlinkButton Content="必应翻译 API" NavigateUri="https://www.microsoft.com/en-us/translator/business/translator-api/"/>
                            <HyperlinkButton Content="百度翻译 API" NavigateUri="https://api.fanyi.baidu.com/"/>
                            <HyperlinkButton Content="有道翻译 API" NavigateUri="https://ai.youdao.com/"/>
                        </StackPanel>
                    </controls:Expander>
                </StackPanel>
            </DataTemplate>

            <Style x:Key="AvatarButtonStyle" TargetType="Button">
                <Setter Property="Background" Value="Transparent" />
                <Setter Property="BorderThickness" Value="0" />
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="Button">
                            <Grid x:Name="Root" Width="{TemplateBinding Width}" Height="{TemplateBinding Height}" RenderTransformOrigin="0.5,0.5">
                                <Grid.RenderTransform>
                                    <ScaleTransform x:Name="RootScale" ScaleX="1" ScaleY="1" />
                                </Grid.RenderTransform>
                                <ContentPresenter Content="{TemplateBinding Content}" HorizontalAlignment="Center" VerticalAlignment="Center" />
                                <VisualStateManager.VisualStateGroups>
                                    <VisualStateGroup x:Name="CommonStates">
                                        <VisualState x:Name="Normal" />
                                        <VisualState x:Name="PointerOver">
                                            <Storyboard>
                                                <DoubleAnimation Storyboard.TargetName="RootScale" Storyboard.TargetProperty="ScaleX" To="1.06" Duration="0:0:0.1" />
                                                <DoubleAnimation Storyboard.TargetName="RootScale" Storyboard.TargetProperty="ScaleY" To="1.06" Duration="0:0:0.1" />
                                            </Storyboard>
                                        </VisualState>
                                        <VisualState x:Name="Pressed">
                                            <Storyboard>
                                                <DoubleAnimation Storyboard.TargetName="RootScale" Storyboard.TargetProperty="ScaleX" To="0.96" Duration="0:0:0.05" />
                                                <DoubleAnimation Storyboard.TargetName="RootScale" Storyboard.TargetProperty="ScaleY" To="0.96" Duration="0:0:0.05" />
                                            </Storyboard>
                                        </VisualState>
                                        <VisualState x:Name="Disabled"/>
                                    </VisualStateGroup>
                                </VisualStateManager.VisualStateGroups>
                            </Grid>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>
        </Grid.Resources>

        <Grid Height="48" VerticalAlignment="Top" Canvas.ZIndex="100">
            <Grid x:Name="AppTitleBar" Background="Transparent"/>

            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" x:Name="LeftPaddingColumn"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto" x:Name="RightPaddingColumn"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="1" 
                            Orientation="Horizontal" 
                            VerticalAlignment="Center" 
                            Spacing="8" 
                            Margin="16,0,16,0">
                    <Image x:Name="AppIconImage" Width="18" Height="18" Stretch="Uniform"/>
                    <TextBlock x:Name="AppTitleText" 
                               Text="翻译" 
                               FontSize="13" 
                               VerticalAlignment="Center" 
                               Style="{ThemeResource CaptionTextBlockStyle}"/>
                </StackPanel>

                <Grid x:Name="TitleBarCenterControl" 
                      Grid.Column="2" 
                      HorizontalAlignment="Stretch" 
                      VerticalAlignment="Center" 
                      MaxWidth="600">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <ComboBox x:Name="LookupSiteComboBox"
                              Grid.Column="0"
                              MinWidth="110"
                              Margin="0,0,8,0"
                              VerticalAlignment="Center"
                              SelectionChanged="LookupSite_SelectionChanged"
                              Visibility="Visible">
                        <ComboBoxItem Content="Google" Tag="Google"/>
                        <ComboBoxItem Content="必应" Tag="Bing"/>
                        <ComboBoxItem Content="Youdao" Tag="Youdao"/>
                        <ComboBoxItem Content="本地词典（开发中）" Tag="Local"/>
                    </ComboBox>

                    <AutoSuggestBox x:Name="LookupSearchBox"
                                    Grid.Column="1"
                                    HorizontalAlignment="Stretch"
                                    VerticalAlignment="Center"
                                    PlaceholderText="输入要查的词汇..."
                                    QueryIcon="Find"
                                    TextChanged="LookupSearchBox_TextChanged"
                                    QuerySubmitted="LookupSearchBox_QuerySubmitted"/>

                    <Button x:Name="LookupCloseButton"
                            Grid.Column="2"
                            Margin="8,0,0,0"
                            Width="32" Height="32" 
                            Padding="0"
                            Background="Transparent"
                            BorderThickness="0"
                            Content="&#xE711;"
                            FontFamily="Segoe MDL2 Assets"
                            ToolTipService.ToolTip="返回每日一句"
                            Click="LookupCloseButton_Click"
                            Visibility="Collapsed"/>
                </Grid>

                <Grid Grid.Column="3">
                    <Button x:Name="AccountButton"
                            Style="{StaticResource AvatarButtonStyle}"
                            Width="40" 
                            Height="40"
                            Margin="12,0,12,0"
                            Click="AccountButton_Click"
                            IsEnabled="{x:Bind IsAccountButtonEnabled, Mode=OneWay}">
                        <Grid>
                            <controls:PersonPicture x:Name="AccountPicture" 
                            Width="30" 
                            Height="30"
                            PreferSmallImage="True"/>

                            <controls:ProgressRing x:Name="AccountLoadingRing"
                           Width="30"
                           Height="30"
                           IsHitTestVisible="False"
                           IsActive="{x:Bind IsRestoringLogin, Mode=OneWay}"
                           Visibility="{x:Bind AccountLoadingRingVisibility, Mode=OneWay}"/>
                        </Grid>

                        <FlyoutBase.AttachedFlyout>
                            <MenuFlyout
                                x:Name="AccountFlyout"
                                Placement="BottomEdgeAlignedRight"
                                Opening="AccountFlyout_Opening">

                                <MenuFlyoutItem
                                    IsEnabled="False"
                                    Padding="0"
                                    MinWidth="280">
                                    <MenuFlyoutItem.Template>
                                        <ControlTemplate TargetType="MenuFlyoutItem">
                                            <Grid Padding="16" Loaded="FlyoutHeaderGrid_Loaded">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="*"/>
                                                </Grid.ColumnDefinitions>

                                                <controls:PersonPicture
                                                    x:Name="FlyoutAvatar"
                                                    Width="48"
                                                    Height="48"
                                                    VerticalAlignment="Center"/>

                                                <StackPanel
                                                    Grid.Column="1"
                                                    Margin="12,0,0,0"
                                                    VerticalAlignment="Center">
                                                    <TextBlock
                                                        x:Name="FlyoutName"
                                                        Text="未登录"
                                                        FontWeight="SemiBold"
                                                        Foreground="{ThemeResource SystemControlForegroundBaseHighBrush}"
                                                        TextTrimming="CharacterEllipsis"/>
                                                    <TextBlock
                                                        x:Name="FlyoutEmail"
                                                        Text=""
                                                        FontSize="12"
                                                        Opacity="0.7"
                                                        Foreground="{ThemeResource SystemControlForegroundBaseHighBrush}"
                                                        TextTrimming="CharacterEllipsis"/>
                                                </StackPanel>
                                            </Grid>
                                        </ControlTemplate>
                                    </MenuFlyoutItem.Template>
                                </MenuFlyoutItem>

                                <MenuFlyoutSeparator/>

                                <MenuFlyoutItem
                                    x:Name="LoginMenuItem"
                                    Text="登录"
                                    Click="LoginMenuItem_Click">
                                    <MenuFlyoutItem.Icon>
                                        <FontIcon Glyph="&#xE716;"/>
                                    </MenuFlyoutItem.Icon>
                                </MenuFlyoutItem>

                                <MenuFlyoutItem
                                    x:Name="SwitchAccountMenuItem"
                                    Text="切换账号"
                                    Click="SwitchAccountMenuItem_Click"
                                    Visibility="Collapsed">
                                    <MenuFlyoutItem.Icon>
                                        <FontIcon Glyph="&#xE748;"/>
                                    </MenuFlyoutItem.Icon>
                                </MenuFlyoutItem>

                                <MenuFlyoutItem
                                    x:Name="LogoutMenuItem"
                                    Text="注销"
                                    Click="LogoutMenuItem_Click"
                                    Visibility="Collapsed">
                                    <MenuFlyoutItem.Icon>
                                        <FontIcon Glyph="&#xF3B1;"/>
                                    </MenuFlyoutItem.Icon>
                                </MenuFlyoutItem>

                                <MenuFlyoutSeparator/>

                                <MenuFlyoutItem
                                    x:Name="SettingsMenuItem"
                                    Text="账户设置"
                                    Click="SettingsItem_Click"
                                    Visibility="Collapsed">
                                    <MenuFlyoutItem.Icon>
                                        <FontIcon Glyph="&#xEF58;"/>
                                    </MenuFlyoutItem.Icon>
                                </MenuFlyoutItem>

                            </MenuFlyout>
                        </FlyoutBase.AttachedFlyout>

                    </Button>
                </Grid>
            </Grid>
        </Grid>

        <Grid Margin="0,48,0,0">
            <controls:NavigationView x:Name="NavView" 
                                     PaneDisplayMode="Left"
                                     IsSettingsVisible="True" 
                                     IsBackButtonVisible="Visible" 
                                     IsPaneToggleButtonVisible="True" 
                                     BackRequested="NavView_BackRequested" 
                                     SelectionChanged="NavView_SelectionChanged">
                <controls:NavigationView.MenuItems>
                    <controls:NavigationViewItem x:Name="Nav_Online" Content="查词" Icon="Find" Tag="WordLookupPage"/>
                    <controls:NavigationViewItem x:Name="Nav_Lookup" Content="互译" Icon="Globe" Tag="OnlineTranslatePage"/>
                    <controls:NavigationViewItem x:Name="Nav_Fav" Content="收藏" Tag="FavoritesPage">
                        <controls:NavigationViewItem.Icon>
                            <SymbolIcon x:Name="FavIcon" Symbol="Favorite"/>
                        </controls:NavigationViewItem.Icon>
                    </controls:NavigationViewItem>
                </controls:NavigationView.MenuItems>
                <Frame x:Name="ContentFrame"/>
            </controls:NavigationView>
        </Grid>

        <Grid x:Name="LoadingOverlay" Background="#80000000" Visibility="Collapsed" Canvas.ZIndex="2000">
            <ProgressRing IsActive="True" Width="60" Height="60" HorizontalAlignment="Center" VerticalAlignment="Center"/>
        </Grid>

        <Grid HorizontalAlignment="Center" VerticalAlignment="Top" Margin="0,60,0,0" Canvas.ZIndex="3000">
            <controls:InfoBar x:Name="TopInfoBar" IsOpen="False" IsClosable="False">
                <controls:InfoBar.RenderTransform>
                    <TranslateTransform Y="-100"/>
                </controls:InfoBar.RenderTransform>
            </controls:InfoBar>
        </Grid>
    </Grid>
</Page>